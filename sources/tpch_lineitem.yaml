---
source_name: "tpch_lineitem"
source_table: "samples.tpch.lineitem"
target_table: "enriched_lineitem"
raw_attributes:
- l_comment string
- l_commitdate date
- l_discount decimal
- l_extendedprice decimal
- l_linenumber int
- l_linestatus string
- l_orderkey long
- l_partkey long
- l_quantity decimal
- l_receiptdate date
- l_returnflag string
- l_shipdate date
- l_shipinstruct string
- l_shipmode string
- l_suppkey long
- l_tax decimal
rules:
- name: "net_price_int"
  expression: "([This].l_extendedprice - [This].l_tax - [This].l_discount)*100"
- name: "c_n_nationkey"
  expression: "[tpch_nation].n_nationkey"
  parameters:
  - source_name: tpch_nation
    relations:
      - "[tpch_lineitem]- orderkey -[tpch_orders]"
      - "[tpch_orders]- custkey -[tpch_customer]"
      - "[tpch_customer]- nationkey -[tpch_nation]"
- name: "max_receipt_date_by_nation"
  expression: MAX([This].l_receiptdate) OVER (PARTITION BY [This].c_n_nationkey)
- name: "max_receipt_date_by_nation_plus_30"
  expression: date_add([This].max_receipt_date_by_nation,30)
- name: o_orderstatus
  expression: "[tpch_orders].o_orderstatus"
- name: o_orderdate
  expression: "[tpch_orders].o_orderdate"
- name: o_orderpriority
  expression: "[tpch_orders].o_orderpriority"
- name: o_clerk
  expression: "[tpch_orders].o_clerk"
- name: o_shippriority
  expression: "[tpch_orders].o_shippriority"
- name: o_comment
  expression: "[tpch_orders].o_comment"
- name: c_custkey
  expression: "[tpch_customer].c_custkey"
- name: c_name
  expression: "[tpch_customer].c_name"
- name: c_address
  expression: "[tpch_customer].c_address"
- name: c_phone
  expression: "[tpch_customer].c_phone"
- name: c_mktsegment
  expression: "[tpch_customer].c_mktsegment"
- name: c_comment
  expression: "[tpch_customer].c_comment"
- name: ps_comment
  expression: "[tpch_partsupp].ps_comment"
- name: p_name
  expression: "[tpch_part].p_name"
- name: p_mfgr
  expression: "[tpch_part].p_mfgr"
- name: p_brand
  expression: "[tpch_part].p_brand"
- name: p_type
  expression: "[tpch_part].p_type"
- name: p_container
  expression: "[tpch_part].p_container"
- name: p_comment
  expression: "[tpch_part].p_comment"
- name: s_name
  expression: "[tpch_supplier].s_name"
- name: s_address
  expression: "[tpch_supplier].s_address"
- name: s_phone
  expression: "[tpch_supplier].s_phone"
- name: s_comment
  expression: "[tpch_supplier].s_comment"
- name: c_n_name
  expression: "[tpch_nation].n_name"
  parameters:
  - source_name: tpch_nation
    relations:
      - "[tpch_lineitem]- orderkey -[tpch_orders]"
      - "[tpch_orders]- custkey -[tpch_customer]"
      - "[tpch_customer]- nationkey -[tpch_nation]"
- name: c_n_comment
  expression: "[tpch_nation].n_comment"
  parameters:
  - source_name: tpch_nation
    relations:
      - "[tpch_lineitem]- orderkey -[tpch_orders]"
      - "[tpch_orders]- custkey -[tpch_customer]"
      - "[tpch_customer]- nationkey -[tpch_nation]"
- name: c_r_regionkey
  expression: "[tpch_region].r_regionkey"
  parameters:
  - source_name: tpch_region
    relations:
      - "[tpch_lineitem]- orderkey -[tpch_orders]"
      - "[tpch_orders]- custkey -[tpch_customer]"
      - "[tpch_customer]- nationkey -[tpch_nation]"
      - "[tpch_nation]- nationkey -[tpch_region]"
- name: c_r_name
  expression: "[tpch_region].r_name"
  parameters:
  - source_name: tpch_region
    relations:
      - "[tpch_lineitem]- orderkey -[tpch_orders]"
      - "[tpch_orders]- custkey -[tpch_customer]"
      - "[tpch_customer]- nationkey -[tpch_nation]"
      - "[tpch_nation]- nationkey -[tpch_region]"
- name: c_r_comment
  expression: "[tpch_region].r_comment"
  parameters:
  - source_name: tpch_region
    relations:
      - "[tpch_lineitem]- orderkey -[tpch_orders]"
      - "[tpch_orders]- custkey -[tpch_customer]"
      - "[tpch_customer]- nationkey -[tpch_nation]"
      - "[tpch_nation]- nationkey -[tpch_region]"
- name: s_n_nationkey
  expression: "[tpch_nation].n_nationkey"
  parameters:
  - source_name: tpch_nation
    relations:
      - "[tpch_lineitem]- partkeysuppkey -[tpch_partsupp]"
      - "[tpch_partsupp]- suppkey -[tpch_supplier]"
      - "[tpch_supplier]- nationkey -[tpch_nation]"
- name: s_n_name
  expression: "[tpch_nation].n_name"
  parameters:
  - source_name: tpch_nation
    relations:
      - "[tpch_lineitem]- partkeysuppkey -[tpch_partsupp]"
      - "[tpch_partsupp]- suppkey -[tpch_supplier]"
      - "[tpch_supplier]- nationkey -[tpch_nation]"
- name: s_n_comment
  expression: "[tpch_nation].n_comment"
  parameters:
  - source_name: tpch_nation
    relations:
      - "[tpch_lineitem]- partkeysuppkey -[tpch_partsupp]"
      - "[tpch_partsupp]- suppkey -[tpch_supplier]"
      - "[tpch_supplier]- nationkey -[tpch_nation]"
- name: s_r_regionkey
  expression: "[tpch_region].r_regionkey"
  parameters:
  - source_name: tpch_region
    relations:
      - "[tpch_lineitem]- partkeysuppkey -[tpch_partsupp]"
      - "[tpch_partsupp]- suppkey -[tpch_supplier]"
      - "[tpch_supplier]- nationkey -[tpch_nation]"
      - "[tpch_nation]- nationkey -[tpch_region]"
- name: s_r_name
  expression: "[tpch_region].r_name"
  parameters:
  - source_name: tpch_region
    relations:
      - "[tpch_lineitem]- partkeysuppkey -[tpch_partsupp]"
      - "[tpch_partsupp]- suppkey -[tpch_supplier]"
      - "[tpch_supplier]- nationkey -[tpch_nation]"
      - "[tpch_nation]- nationkey -[tpch_region]"
- name: s_r_comment
  expression: "[tpch_region].r_comment"
  parameters:
  - source_name: tpch_region
    relations:
      - "[tpch_lineitem]- partkeysuppkey -[tpch_partsupp]"
      - "[tpch_partsupp]- suppkey -[tpch_supplier]"
      - "[tpch_supplier]- nationkey -[tpch_nation]"
      - "[tpch_nation]- nationkey -[tpch_region]"
- name: l_receiptdate_yearmonth
  expression: "date_format([This].l_receiptdate, \"yyyyMM\")"
- name: revenue
  expression: "[This].l_extendedprice - [This].l_tax - [This].l_discount"
- name: revenue_no_returns
  expression:
    "CASE WHEN [This].l_returnflag IS TRUE
    THEN [This].revenue
    ELSE 0
    END"